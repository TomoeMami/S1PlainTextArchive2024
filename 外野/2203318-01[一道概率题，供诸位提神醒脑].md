
*****

####  NaCN  
##### 1#       楼主       发表于 2024-10-16 09:00

 本帖最后由 NaCN 于 2024-10-16 09:00 编辑 

袋中有n个白球（n→∞），每次随机摸出一个球，按如下规则操作：

1 摸出白球，涂成半红半白，放回袋内；

2 摸出半红半白球，涂成全红，放回袋内；

3 摸出红球，什么也不做，放回袋内。

求以下问题的解析解

问题1：当涂色n次，袋中半红半白球的比例期望是多少？

问题2：当袋中半红半白球的比例期望最高时，应当涂色几次？此时半红半白球的比例期望是多少？

这题目来源于我对实践问题的抽象概括，问题难点在于询问涂色次数而不是摸球次数。我在网上寻找解答未果，问AI给出的也是错误答案，用程序模拟可以得到数值解，但我自己没能推导解析解。

可能是道很简单的题目，知道S1藏龙卧虎，发出来供诸位打工时摸鱼，顺便问问有没有网友能看出来我实践中是想解决什么问题。

*****

####  最爱红狼  
##### 2#       发表于 2024-10-16 09:05

这种很难，现在有计算机，基本都是编程求近似解

*****

####  阿菠萝13  
##### 3#       发表于 2024-10-16 09:24

问题2：目测应当涂色1次，比例期望是100%。因为袋中有1个白球时，摸1次球并涂色的操作是确定的<img src="https://static.saraba1st.com/image/smiley/face2017/004.gif" referrerpolicy="no-referrer">

可能我没看懂题目，溜了溜了

*****

####  马猴肥宅  
##### 4#       发表于 2024-10-16 09:31

 本帖最后由 马猴肥宅 于 2024-10-16 10:22 编辑 
<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=66462005&amp;ptid=2203318" target="_blank">阿菠萝13 发表于 2024-10-16 09:24</a>

问题2：目测应当涂色1次，比例期望是100%。因为袋中有1个白球时，摸1次球并涂色的操作是确定的

可能我没看 ...</blockquote>
有两个球摸两次的时候袋中半球占比期望只有50%（

-------

看错了看成对问题1的解答了 不好意思

*****

####  大青衣  
##### 5#       发表于 2024-10-16 09:36

每次觉得自己得出解的下一秒就被自己推翻了

*****

####  东窗下的鸟  
##### 6#       发表于 2024-10-16 09:39

n趋近无穷大，每次摸出白球的可能性趋近1，
最后是不是导致全是半白半红球
—— 来自 [S1Fun](https://s1fun.koalcat.com)

*****

####  qb212  
##### 7#       发表于 2024-10-16 09:40

最近泥潭是流行做各种数学题吗<img src="https://static.saraba1st.com/image/smiley/face2017/001.png" referrerpolicy="no-referrer">

*****

####  wing130083  
##### 8#       发表于 2024-10-16 09:42

问题2答案肯定是n=1，100%半红半白

lz是不是想问红或者白球的占比期望最高？

*****

####  AshPenguin  
##### 9#       发表于 2024-10-16 09:42

我的直觉告诉我应该写个巨大的马尔可夫转移矩阵，然后解平衡方程<img src="https://static.saraba1st.com/image/smiley/face2017/007.png" referrerpolicy="no-referrer">

*****

####  NaCN  
##### 10#         楼主| 发表于 2024-10-16 09:46

<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=66462164&amp;ptid=2203318" target="_blank">wing130083 发表于 2024-10-16 09:42</a>

问题2答案肯定是n=1，100%半红半白

lz是不是想问红或者白球的占比期望最高？ ...</blockquote>
限制条件在第一行：n个白球（n→∞）

*****

####  马桶3  
##### 11#       发表于 2024-10-16 09:46

 本帖最后由 马桶3 于 2024-10-16 09:53 编辑 

有n个球，摸n次

那么两个n应该是相等的

那么n次后红白球的期望是36.8%

哎呀是涂啊，那要重新搞了<img src="https://static.saraba1st.com/image/smiley/face2017/252.png" referrerpolicy="no-referrer">

n个球涂n次，红白球期望是36.4%

好像区别也不大嘛<img src="https://static.saraba1st.com/image/smiley/face2017/088.png" referrerpolicy="no-referrer">

*****

####  NaCN  
##### 12#         楼主| 发表于 2024-10-16 09:51

 本帖最后由 NaCN 于 2024-10-16 09:52 编辑 
<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=66462165&amp;ptid=2203318" target="_blank">AshPenguin 发表于 2024-10-16 09:42</a>

我的直觉告诉我应该写个巨大的马尔可夫转移矩阵，然后解平衡方程</blockquote>
我考虑过但想不到下手的点，请问有没有更详细的思路

*****

####  東雲千夜子  
##### 13#       发表于 2024-10-16 09:58

 本帖最后由 東雲千夜子 于 2024-10-16 10:20 编辑 

搞不懂不猜了

*****

####  stplum  
##### 14#       发表于 2024-10-16 10:02

数学扔下多少年了……如果从n=1的例子起做归纳是否可行？

*****

####  ggby  
##### 15#       发表于 2024-10-16 10:03

一直操作 红球/有色 应该是一直等于 有色/n 的吧

列个普通方程就有了

*****

####  a4ac7  
##### 16#       发表于 2024-10-16 10:04

 本帖最后由 a4ac7 于 2024-10-16 10:14 编辑 

让gpt试一下，第一个步骤就看不懂
 <blockquote>推广到任意 n 的情况
问题1：经过 t 次涂色操作后，袋中半红半白球的比例的期望值
设 H(t) 为经过 t 次操作后，袋中半红半白球的期望数量。

递推关系：

E[H(t)] = (n * t)/(n-1) * (1 - 1/n)^t

因此，比例期望为：

比例期望 = E[H(t)]/n = t/(n-1) * (1 - 1/n)^t

当 t = n 时：

比例期望 = n/(n-1) * (1 - 1/n)^n ≈ 1/e ≈ 0.3679

问题2：半红半白球比例的期望值达到最大时，应进行多少次涂色操作
为了找到 E[H(t)] 的最大值，对 t 进行优化。

设：

f(t) = (n * t)/(n-1) * (1 - 1/n)^t

取自然对数：

ln f(t) = ln t + t * ln(1 - 1/n) + ln(n/(n-1))

对 t 求导并令导数为零：

d/dt ln f(t) = 1/t + ln(1 - 1/n) = 0 因此： t = -1/ln(1 - 1/n)

利用泰勒展开 ln(1 - x) ≈ -x（当 x 较小时）：

t ≈ n

因此，在 t = n 附近，期望值 E[H(t)] 达到最大值。

最大期望比例：
对于较大的 n，该最大值近似为 1/e ≈ 0.3679。

结论
问题1：对于任意 n，经过 t 次涂色操作后，袋中半红半白球的比例的期望值为：

比例期望 = t/(n-1) * (1 - 1/n)^t

当 t = n 时：

比例期望 ≈ 1/e ≈ 0.3679

问题2：半红半白球比例的期望值在 t = n 时达到最大。此时，最大比例期望约为 1/e ≈ 0.3679。</blockquote>
—— 来自 [鹅球](https://www.pgyer.com/GcUxKd4w) v3.2.91

*****

####  Jet.Black  
##### 17#       发表于 2024-10-16 10:05

作为程序员，跑个蒙特卡洛不过分吧？

*****

####  AshPenguin  
##### 18#       发表于 2024-10-16 10:08

 本帖最后由 AshPenguin 于 2024-10-16 10:41 编辑 
<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=66462258&amp;ptid=2203318" target="_blank">NaCN 发表于 2024-10-16 09:51</a>

我考虑过但想不到下手的点，请问有没有更详细的思路</blockquote>
我先试一下传统方法

第一问，涂色k次，所有可能的状态数 C(k,2n) 每种状态可能性相同，其中i个半红半白的状态数C(i,n)*2^i*C((k-i)/2,n-i)。对每个k都找到i对应的状态可能性，应该用归纳法可以做。或者，这应该是个变种的binomial分布，可以用高斯分布近似。

第二问，假设上一问里k和i的关系得到了，求个导应该就行了，大概。。

既然n趋近于无穷， 如果这是真的一道题的话，肯定是要用高斯分布对这种离散分布做近似的。当然这貌似不是一道题所以思路也不一定对

*****

####  紧那罗  
##### 19#       发表于 2024-10-16 10:10

问题2：当袋中半红半白球的比例期望最高时，应当涂色几次？此时半红半白球的比例期望是多少？

跳过第一个问题的话，假设全红球数为k，则半红半白占比应该是(n-k)/2/n。 超过这个比例后，下一次摸球半红半白球增加的期望为负数。这个应该比较好算。
摸球次数为2k+(n-k)/2＝2/n+3/2k

—— 来自 [鹅球](https://www.pgyer.com/xfPejhuq) v3.0.86-alpha

*****

####  蹲起丁烷  
##### 20#       发表于 2024-10-16 10:10

状态转移的概率不确定啊<img src="https://static.saraba1st.com/image/smiley/face2017/018.png" referrerpolicy="no-referrer">

—— 来自 [S1Fun](https://s1fun.koalcat.com)

*****

####  GJRstone  
##### 21#       发表于 2024-10-16 10:12

这个n是确数又是无限，一下子确实没想到怎么搞

*****

####  perfect_duck  
##### 22#       发表于 2024-10-16 10:15

t -&gt; n 时，e  ^ (- t / n) = 0.368

*****

####  濡鸦之羽_  
##### 23#       发表于 2024-10-16 10:16

 本帖最后由 濡鸦之羽_ 于 2024-10-16 10:22 编辑 

感觉不是很难，随机涂，每个球可以被涂很多次，把分布写出来，大于1切一刀，小于1切一刀，分析变化过程就行了。

n→∞是比较搞的一点，具体搞在哪没动笔算

*****

####  takami  
##### 24#       发表于 2024-10-16 10:16

楼主是研究传染病的？<img src="https://static.saraba1st.com/image/smiley/face2017/053.png" referrerpolicy="no-referrer">

*****

####  蹲起丁烷  
##### 25#       发表于 2024-10-16 10:18

 本帖最后由 蹲起丁烷 于 2024-10-16 10:20 编辑 

编辑了

—— 来自 [S1Fun](https://s1fun.koalcat.com)

*****

####  VMDL  
##### 26#       发表于 2024-10-16 10:23

 本帖最后由 VMDL 于 2024-10-16 11:31 编辑 

这是误以为红色可以继续涂的读错题版本，可以无视<img src="https://static.saraba1st.com/image/smiley/face2017/001.png" referrerpolicy="no-referrer">

---------------------------------------------------------------------------

问题1：

令摸球次数为 m，枚举所有可能的 n^m 种情况（从摸 m 个 1 一直到摸 m 个 n）：

当且仅当某个球只被摸到 1 次时才为半红半白，对单一的一个球而言，这种情况意味着在 m 次中的某次摸球选中自己而在其他情况选中其他球，因此情况数为 m*(n-1)^(m-1)

对于每个球而言这种情况的出现次数是相等的，因此总数为 m*(n-1)^(m-1) 乘上 n，除以 n^m 得到期望为 m/n*(n-1)^(m-1)/n^(m-1) 或者 m/n*(1-1/n)^(m-1)

当 m=n 且 n 趋于无穷即为 1/e

问题2：

大概求个导就行了吧...

求导求出结果是 1/ln(1+1/(n-1))，介于 n-1 和 n 之间，但算一下会发现 n 大于 1 的时候抽 n-1 次和 n 次结果是一样的，所以抽 n-1 次和 n 次都能取到最大值

*****

####  张子虚  
##### 27#       发表于 2024-10-16 10:25

每个状态的概率大小倒是可以用组合数写出来，但这样的解析解对于求期望貌似没啥帮助

*****

####  xiaoleirei  
##### 28#       发表于 2024-10-16 10:30

<blockquote>这个问题是一个经典的几何分布问题，可以通过概率论中的期望值来解决。我们假设每次取球都是独立的，并且每次取到白球的概率为p（由于袋子里有无穷个白球，我们可以假设p接近于1，但为了数学上的严谨性，我们不假设它等于1），那么取到半红半白球的概率就是1−p。

每次取球，如果取到白球，我们就将其涂成半红半白，这样半红半白球的数量就会增加1。如果取到半红半白球，我们就将其涂成全红，这样半红半白球的数量就会减少1。我们的目标是找到涂多少次后，半红半白球的比例期望值最高。

设X为取到第一个半红半白球所需的取球次数，那么X服从几何分布，其期望值为E(X)=1/p。

在第一次取到半红半白球之前，我们取到的都是白球，所以半红半白球的比例为0。在第一次取到半红半白球之后，我们将其涂成全红，半红半白球的比例变为0。因此，半红半白球的比例期望值在第一次取到半红半白球时达到最大。

由于每次取球都是独立的，我们可以推断，随着取球次数的增加，半红半白球的比例期望值会逐渐降低，因为每次取到半红半白球都会将其涂成全红，从而降低半红半白球的比例。

因此，半红半白球的比例期望值在第一次取到半红半白球时最高，即取球次数为E(X)=1/p次时。由于p接近于1，所以E(X)接近于1次。这意味着在第一次取球时，半红半白球的比例期望值最高，因为此时我们还没有将其涂成全红。随着取球次数的增加，半红半白球的比例期望值会逐渐降低。</blockquote>这应该不对吧

*****

####  RJG丶one  
##### 29#       发表于 2024-10-16 10:34

 本帖最后由 RJG丶one 于 2024-10-16 10:40 编辑 

模拟了一下，你前后两个n是一个n的话，比例大约是36.7% Counter({1: 36788022, 0: 36785362, 2: 26426616})复制代码

试了假如对n个球摸2n，3n，4n……10n次的结果，基本满足半红半白是白色的2，3，4……10倍 Counter({0: 368000, 1: 367773, 2: 264227}) Counter({2: 594546, 1: 270555, 0: 134899}) Counter({2: 800690, 1: 149768, 0: 49542}) Counter({2: 908858, 1: 72765, 0: 18377}) Counter({2: 959718, 1: 33640, 0: 6642}) Counter({2: 982646, 1: 14902, 0: 2452}) Counter({2: 992765, 1: 6314, 0: 921}) Counter({2: 996917, 1: 2725, 0: 358}) Counter({2: 998770, 1: 1105, 0: 125}) Counter({2: 999511, 1: 424, 0: 65})复制代码
综合来看，0的数量随摸的次数指数减小，1的数量是0的摸的次数倍。拿程序模拟了下，基本就是n个球摸n次时，1的占比最大
 from collections import Counter   import random   def simulate(list):     n=len(list)     ampier = 1.0 #改倍率     for i in range(int(n*ampier)):         random_num = random.randint(0,n-1)         k = list[random_num]         if k == 0 :list[random_num]=1         if k == 1 :list[random_num]=2     counter = Counter(list)       print(counter)  n = 1000000 #改模拟次数 list = [0]*n simulate(list)复制代码

*****

####  huanyanqia  
##### 30#       发表于 2024-10-16 10:38

 本帖最后由 huanyanqia 于 2024-10-16 10:44 编辑 

这题没看太明白，这个摸球n次的“n”也接近无穷大吗，还是说就只是另外一个确定的数。

PS：看了上面回复明白了，这个n也趋近无穷大。

那这个题就简化为n个球，摸n次，求有多少球只被摸了1次。

*****

####  Ne0  
##### 31#       发表于 2024-10-16 10:44

问题不难，甚至都不需要随机过程的知识。简单算了一下，也编程测试过了正确性。

问题 1 等价于，n 个球取出放回 m 次（其中 m = n）之后，恰好被取出过 1 次的球的个数的期望。

每个球被取出的概率为 1/n，m 次中恰被取出 1 次的概率为 m (1/n) ((n-1)/n)^(m-1). 对于每个球相互独立，所以个数的期望就是乘以 n.

m = n, 那么半红半白球的比例期望是 (1 - 1/n)^n, 极限是 1/e.

问题 2 只要带入上面的结果，计算一下拐点就行了，应当涂色 n-1 次

﹍﹍﹍

评分

 参与人数 4战斗力 +4

|昵称|战斗力|理由|
|----|---|---|
| salic428| + 1||
| 兔耳僵尸| + 1|好评加鹅|
| a4ac7| + 1|有点看懂了|
| RJG丶one| + 1|好评加鹅|

查看全部评分

*****

####  哩子ayil  
##### 32#       发表于 2024-10-16 10:47

总感觉大学的时候做过疑似的题目，写出来的式子很像个泰勒展开式，然后能收回一个解，不过当时我也是电脑跑的，现在不会做了

*****

####  AshPenguin  
##### 33#       发表于 2024-10-16 10:53

<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=66462881&amp;ptid=2203318" target="_blank">Ne0 发表于 2024-10-16 10:44</a>

问题不难，甚至都不需要随机过程的知识。简单算了一下，也编程测试过了正确性。

问题 1 等价于，n 个球取 ...</blockquote>
但是主楼里是涂色m次啊。。。也就是每个球最多被取出放回2次

*****

####  NaCN  
##### 34#         楼主| 发表于 2024-10-16 10:56

<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=66462881&amp;ptid=2203318" target="_blank">Ne0 发表于 2024-10-16 10:44</a>

问题不难，甚至都不需要随机过程的知识。简单算了一下，也编程测试过了正确性。

问题 1 等价于，n 个球取 ...</blockquote>
题目中的要求的和您的理解不等价，红球再被取出不会算到涂色次数里，所以涂色了n次实际取球的次数是要大于n的。或者说取出两次的球就失去了再被取出的资格，剩余的球被取出的概率要大于1/n，而这个概率又和当时有几个红色的球有关，要分别计算。

*****

####  Victorino  
##### 35#       发表于 2024-10-16 11:04

n无限的话是算不了的吧，你要怎么样从无限的球中抽出之前涂过的

*****

####  很久就在那边l  
##### 36#       发表于 2024-10-16 11:28

<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=66463015&amp;ptid=2203318" target="_blank">NaCN 发表于 2024-10-16 10:56</a>
题目中的要求的和您的理解不等价，红球再被取出不会算到涂色次数里，所以涂色了n次实际取球的次数是要大 ...</blockquote>
不需要考虑剩余球概率啊，直接设一共取了m次，得到被取零次一次和两次以上的期望，根据总涂色为n次的约束得到m

*****

####  VMDL  
##### 37#       发表于 2024-10-16 11:29

 本帖最后由 VMDL 于 2024-10-16 11:33 编辑 

原来之前读错题了，，，

现在的题意相当于有 n 个盒子，每个盒子有两个空位，需要往 n 个盒子里随机放 m 个球，求只有一个球的盒子的个数的期望

考虑 c(2n,m) 种可能的放法，对于每一个盒子而言，其中含有一个球的方案数是自己放一个球，剩下的随便放，即 2 乘上 c(2n-2,m-1)，那么总数就是 2*c(2n-2,m-1)*n，期望即为 2*c(2n-2,m-1)*n 除以总方案数 c(2n，m)

考虑到 c(n,m)=n!/m!/(n-m)!，对原式拆项得到答案为 2n 乘上 (2n-2)!*m!*(2n-m)! 再除以 2n!*(m-1)!*(2n-m-1)!

依次两两相消得到期望个数为 (2n-m)*m/(2n-1)，比例即上式除以 n

对于问题 1 的 m=n，答案即为 n/(2n-1)

对于问题 2，显然 m=n 时最大，为 n/(2n-1)

*****

####  http404  
##### 38#       发表于 2024-10-16 11:37

<blockquote>很久就在那边l 发表于 2024-10-16 11:28
不需要考虑剩余球概率啊，直接设一共取了m次，得到被取零次一次和两次以上的期望，根据总涂色为n次的约束 ...</blockquote>
这样是得不到m的，因为本质上总涂色n的情况下，取出次数m可以是大于等于n的任意整数

*****

####  AshPenguin  
##### 39#       发表于 2024-10-16 11:38

涂色k次，所有可能的状态数 C(2n,k) 每种状态可能性相同，其中i个半红半白的状态数C(n,i)*2^i*C(n-i,(k-i)/2)

如果保证k-i是偶数，这是个离散概率函数P(i;k)=C(n,i)*2^i*C(n-i,(k-i)/2)/C(2n,k), 现在要求的是E[P(i;k=n)]

k=n,n-&gt;∞, C(2n,k)=C(2n,n)-&gt;4n/(pi*n)^0.5

令j=(k-i)/2

P(i)=C(n,2j)*2^(n-2j)*C(2j,j)/C(2n,n)=C(n,j)*C(n-j,j)*2^(n-2j)/C(2n,n)

Let j=c*n, c的范围[0,1/2]

由Stirling近似 （后面我交给GPT了）

最后化简得c=1/4时，也就是i=1/2时P(i)最大，是高斯近似的中心，也就是期望

所以期望是n/2

*****

####  诶呦我去这是哪  
##### 40#       发表于 2024-10-16 12:04

这是一个有趣的概率问题。让我们一步步分析并解答这两个问题。

问题1：当涂色n次，袋中半红半白球的比例期望是多少？

让我们定义以下变量：

x(n) - n次操作后，半红半白球的比例期望

y(n) - n次操作后，全红球的比例期望

第n次操作后，我们可以得到以下递推关系：

x(n) = x(n-1) + (1 - x(n-1) - y(n-1)) - x(n-1)/2

y(n) = y(n-1) + x(n-1)/2

简化后：

x(n) = x(n-1) + 1 - 3x(n-1)/2 - y(n-1)

y(n) = y(n-1) + x(n-1)/2

初始条件：x(0) = 0, y(0) = 0

通过求解这个递推关系，我们可以得到x(n)的解析解：

x(n) = (2/3) * (1 - e^(-3n/4))

问题2：当袋中半红半白球的比例期望最高时，应当涂色几次？此时半红半白球的比例期望是多少？

要找到x(n)的最大值，我们需要求导并令其等于0：

dx/dn = (1/2) * e^(-3n/4)

令dx/dn = 0，我们发现n趋向于无穷大时，x(n)达到最大值。

当n趋向于无穷大时，x(n)的极限值为：

lim(n→∞) x(n) = 2/3

因此，答案如下：

当涂色n次时，袋中半红半白球的比例期望是 (2/3) * (1 - e^(-3n/4))。

理论上，当涂色次数趋向于无穷大时，半红半白球的比例期望达到最大值。此时，半红半白球的比例期望是 2/3，约等于 0.6667。

需要注意的是，虽然理论上需要无限次涂色才能达到最大值，但在实际操作中，当n足够大时（例如，几百次或几千次），x(n)已经非常接近其极限值2/3。


*****

####  goodbetter  
##### 41#       发表于 2024-10-16 12:06

我觉得和n的值有关，当n为无穷时。可以认为每次摸出的都是白球。红球数应为零。

*****

####  Nanachi  
##### 42#       发表于 2024-10-16 12:08

第一行n趋近于无限<img src="https://static.saraba1st.com/image/smiley/face2017/001.png" referrerpolicy="no-referrer">

—— 来自 [鹅球](https://www.pgyer.com/GcUxKd4w) v3.2.91


*****

####  库德里尔  
##### 43#       发表于 2024-10-16 12:14

我想过另一个版本。

有n个白球，每次摸出出k个将其涂成红色再放回。这计为一次操作。

如果在第m次操作后，红球的数量达到了A，则停止。求停止时操作次数的期望。


*****

####  NaCN  
##### 44#         楼主| 发表于 2024-10-16 13:44

这道概率计算来自于我实际工作中遇到的问题，一个结构对称的化合物W-X-W，两端有相同的基团W（White）可以和保护试剂P反应转化为基团R（Red）。自然地，有以下反应：
W-X-W + P → W-X-R （单保护产物）
W-X-R + P → R-X-R （双保护产物）
R-X-R + P → 不反应

我想知道什么条件下能以最大收率获得单保护产物W-X-R。实际操作时还涉及到原料和单保护产物中W的反应活性、活化能Ea、反应速率常数k、反应物浓度，最后应该列出单保护产物浓度是时间t的函数f(t)，再对f(t)求导。

因为过于复杂，我在这里全部简化，假设每次只有一个分子P加入到原料溶液中，原料和单保护产物的活性相同，马上能和P反应，不用考虑时间t的因素。那么当使用多少量的P才能让W-X-R的产率最高呢？

于是上述案例转化成白球涂色，对于n个白球（n个原料W-X-W分子），随机摸出一个球涂色（和试剂分子P碰撞反应），只有白球（原料）和半红半白球（单保护产物）可以涂色（反应），而红球（双保护产物）不再涂色直接放回（即使和分子P碰撞也不反应）。

易知，白球的比例期望值随涂色次数增加单调递减，半红半白球比例先增后减，红球比例单调递增，当涂色2n次后全部都是红球比例为1。那么是不是涂色n次能使半红半白球比例最高呢？因为实际反应中一般为了高产率获得单保护产物，原料和试剂P的投料比例为1:1到1：1.2。可实际模拟下来n个白球涂色n次似乎不是最优解。

最后，回答有些网友的一个问题：n到底是无穷大还是一个数？

实际反应中原料为mmol级别，也就是1e20数量级，有一个明确的数字。题干里写成无穷大是为了可以写成极限，程序模拟下来1e6的数量级已经可以得到准确的数值解。


*****

####  xmmc1800  
##### 45#       发表于 2024-10-16 14:20

 本帖最后由 xmmc1800 于 2024-10-16 14:21 编辑 

非常有意思的一道题，虽然我也没能力推出精确解的通项公式，但看了下目前楼里包括31楼在内的答案应该都是错的，

对于总共n个球的情况，记涂色k次后恰有r个红球的概率为p(k, r)，此时半红半白球数量为(k-2*r)，白球数量为(n-k+r)
考虑(k, r)状态的来源:
1. (k-1, r-1)状态下，一个半红半白球被涂成红球，其概率为(半红半白球数量)/(白球数量+半红半白球数量), 即(k-2*r+1)/(n-r+1) 
2. (k-1, r)状态下，一个白球被涂成半红半白球，其概率为(白球)/(白球数量+半红半白球数量), 即(n-k+r+1)/(n-r) 
因此有递推关系式
p(k, r) = p(k-1, r-1) * (k-2*r+1) / (n-r+1) + p(k-1, r) * (n-k+r+1) / (n-r)
初始条件为p(0, 0)=1, p(0, _)=0

涂色k次后半红半白球比例期望为 sum(p(k, r) * (k-2*r), r=0..floor(k/2))

这样相当于得到了一个复杂度O(n^2)的求精确解算法，但是要从这个递推式得到通项公式目前还没什么头绪

附上第一问半红半白球比例期望在n=1到10的精确解和近似值，可以用来验证其他算法
[(1, 1.00000000000000, 1),
 (2, 0.500000000000000, 1/2),
 (3, 0.481481481481481, 13/27),
 (4, 0.442708333333333, 85/192),
 (5, 0.427760000000000, 5347/12500),
 (6, 0.416181069958848, 25283/60750),
 (7, 0.408539313492862, 227103542/555891525),
 (8, 0.402756963171145, 159703961489/396526878720),
 (9, 0.398338563958694, 337267530400363/846685610975232),
 (10, 0.394822990291931, 575760142406566849/1458274104000000000)]

 至于第二问，我跑了下n在1000以下时最大次数基本都是0.8964*n取整，但有时会有±1的误差，n更大的情况目前还没验证过，但我猜依然会保持一个近似线性的关系


*****

####  mmbk  
##### 46#       发表于 2024-10-16 14:29

<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=66464456&amp;ptid=2203318" target="_blank">NaCN 发表于 2024-10-16 13:44</a>
这道概率计算来自于我实际工作中遇到的问题，一个结构对称的化合物W-X-W，两端有相同的基团W（White）可以 ...</blockquote>
你这简化就很有问题，反应动力学哪能简化成这么简单的模型，什么平衡条件都不考虑的<img src="https://static.saraba1st.com/image/smiley/face2017/223.png" referrerpolicy="no-referrer"> 明明有成熟的理论为什么还要这么费事，不理解


*****

####  kiritokun  
##### 47#       发表于 2024-10-16 15:55

<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=66464456&amp;ptid=2203318" target="_blank">NaCN 发表于 2024-10-16 13:44</a>

这道概率计算来自于我实际工作中遇到的问题，一个结构对称的化合物W-X-W，两端有相同的基团W（White）可以 ...</blockquote>
还是想的太多，过柱子去吧


*****

####  兔耳僵尸  
##### 48#       发表于 2024-10-16 17:29

一下推导非常不严谨，甚至可能是错的<img src="https://static.saraba1st.com/image/smiley/face2017/067.png" referrerpolicy="no-referrer">
n为无穷大的时候，不妨设所有球的集合是一个长度为1的线段。设白球集合的大小（长度）为y，半红半白为z。每次取球涂色本来是一个随机的离散动作，这里变成取一段极小的dl，由于随机，可以认为dl里面y/1的比例是白球，z/1的比例是半红半白。原本要求的涂色次数变成dl里面白色和半红半白的总和长度，记为dx

每次y/（z+y）部分的dx都会被从白色转移到半红半白，而z/（z+y）部分的dx从半红半白变为全红

所以有
dz/dx=(y-z)/(y+z)
dy/dx=-y/(y+z)
解这个方程，最后大概这样
<img src="https://p.sda1.dev/19/9aab0a6f93a852b422611a0628b8b285/image.jpg" referrerpolicy="no-referrer">
第一问是当x=1时，这边用Wolfman alpha大概是0.364311
第二问求导，居然能解出来，是2-3/e约为0.89636的时候取极值


*****

####  CCauchy  
##### 49#       发表于 2024-10-16 20:14

<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=66466311&amp;ptid=2203318" target="_blank">兔耳僵尸 发表于 2024-10-16 17:29</a>
一下推导非常不严谨，甚至可能是错的
n为无穷大的时候，不妨设所有球的集合是一个长度为1的线段。设白球集 ...</blockquote>
方程左边物理意义不是很明确，不如直接不妨将球按照颜色排序，并使每次取dl时取出的三种颜色的球的比例等于全体三种颜色的球的比例

[论坛助手,iPhone](https://bbs.saraba1st.com/2b/forum.php?mod=viewthread&amp;tid=2029836)


*****

####  xmmc1800  
##### 50#       发表于 2024-10-16 22:26

<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=66466311&amp;ptid=2203318" target="_blank">兔耳僵尸 发表于 2024-10-16 17:29</a>

一下推导非常不严谨，甚至可能是错的

n为无穷大的时候，不妨设所有球的集合是一个长度为1的线段。设白球集 ...</blockquote>
好思路！相当于不考虑每个状态的概率，直接从整体期望的角度做递推，然后再把递推方程改写成微分方程

对于总共n个球的情况，记涂色k次后红球比例的期望为r(k)，白球比例的期望为w(k)，半红半白球比例的期望为h(k)，则有

① r(k)+w(k)+h(k)=1

② 2*r(k)+h(k)=k/n

③ r(k)=r(k-1)+h(k-1)/(w(k-1)+h(k-1))

①②代入③可消去w与h，只保留r的递推式

r(k) = r(k-1)+2-(2-(k-1)/n)/(1-r(k-1)), r(0)=0

按这个递推求解，时间复杂度就只有O(n)了，再改写成微分方程的形式，甚至可以得到某种程度上的解析解

r'(t) = 2 - (2 - t )/(1 - r(t)), r(0) = 0

Mathematica求解得 1 + r(t) - t = exp(2 + (-2 + t)/(1 - t + r(t)))，这个方程没有初等形式的解析解，但可以用来做推导，一通求导+代入后得到

t=2-3/e时刻半红半白比例期望最大，最大值刚好是1/e

但是里面有个小问题，③式在离散条件下其实并不成立，解出来的期望和精确解存在一定误差，不过试了下发现这个误差会随着n的增加而减小，n=1e6时量级就到1e-7以下了，对n-&gt;+∞的情况精度应该是足够了，但这个我也没想明白怎么证明

n精确解简化解误差1000.367274380.366293989.8040E-045000.364902250.364706001.9625E-0410000.364606600.364508469.8135E-0550000.364370210.364350581.9629E-05100000.364340670.364330869.8145E-06500000.364317040.364315081.9629E-061000000.364314090.364313119.8146E-075000000.364311720.364311531.9629E-0710000000.364311430.364311339.8146E-08


*****

####  NaCN  
##### 51#         楼主| 发表于 2024-10-16 23:10

<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=66464810&amp;ptid=2203318" target="_blank">mmbk 发表于 2024-10-16 14:29</a>

你这简化就很有问题，反应动力学哪能简化成这么简单的模型，什么平衡条件都不考虑的 明明有成熟的理论为 ...</blockquote>
因为成熟的理论得不出想要的答案。我推导过连续二级反应的动态平衡，但是需要知道k1、k2等才有数值解，所以考虑了上述简化模型。简化后的模型依然难以计算，却是很有意思的概率题，所以发出来供大家讨论。

*****

####  NaCN  
##### 52#         楼主| 发表于 2024-10-16 23:11

<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=66465526&amp;ptid=2203318" target="_blank">kiritokun 发表于 2024-10-16 15:55</a>

还是想的太多，过柱子去吧</blockquote>
难过，极性溶解度导致三者大量交叉。正是因为分离过才会思考如何从根源上优化。


*****

####  fuochai  
##### 53#       发表于 2024-10-17 02:27

你表述太复杂了 应该说有n个盒子 随机放入一些球 然后用球的数量去表述 而不是涂色

—— 來自 Sony XQ-DQ72, Android 14上的 [S1Next-鵝版](https://github.com/ykrank/S1-Next/releases) v2.5.4


*****

####  mmbk  
##### 54#       发表于 2024-10-17 03:18

 本帖最后由 mmbk 于 2024-10-17 03:20 编辑 
<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=66468492&amp;ptid=2203318" target="_blank">NaCN 发表于 2024-10-16 23:10</a>
因为成熟的理论得不出想要的答案。我推导过连续二级反应的动态平衡，但是需要知道k1、k2等才有数值解，所 ...</blockquote>
你想建模那知道速率常数难道不是最最最基础的吗？有时间做这种模型不找个做物化的去测一下吗，不行自己取几个点打下核磁。再不济分类讨论总会吧，本科物化里各种稳态近似啥的难道都有速率常数数值吗。再再再不济带几个估计值算一下找规律总会吧？

何况单保护怎么做文献里多了去了，与其搞这么抽象的模型不如多查查文献改进下方案。我一个不做化学的靠勒夏特列原理都能知道应该加大于等于1 eq.，如果这点都要质疑先把物化课本多翻翻再说

再何况你考虑速率方程有啥意义呢，实际上你假设平衡条件不是足够了？而且你考虑微观反应动力学很明显可以得出K1约等于4K2，这个假设甚至可以让你用解一元二次方程的方式笔算平衡方程。把解析解告诉你，应该投保护剂(1+1/(c0K2)) eq.，这里c0是初始物料浓度。有兴趣可以自己算一遍

思而不学则殆只能说


*****

####  sbjpcn07  
##### 55#       发表于 2024-10-17 08:03

试着把问题拆成若干个小问题？


*****

####  fuochai  
##### 56#       发表于 2024-10-17 12:56

 本帖最后由 fuochai 于 2024-10-17 12:59 编辑 
<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=66469272&amp;ptid=2203318" target="_blank">fuochai 发表于 2024-10-17 02:27</a>

你表述太复杂了 应该说有n个盒子 随机放入一些球 然后用球的数量去表述 而不是涂色

—— 來自 Sony XQ-DQ7 ...</blockquote>
想到了 直接用一个矩阵表示所有的状态对应的期望 第一位是白球数（即空盒子） 第二位是半红半白 （即1个球的盒子）每一行对应一个状态 初始期望矩阵是(1,0;0,0;...) 然后每次操作时对上个期望矩阵的操作是依据所在位置的加权求和 把状态矩阵拉成向量的话每一步都是一个矩阵乘法 所以操作n次就是这个矩阵乘法进行n次 如果有jordan标准型就直接可以化简了 没有的话矩阵分析应该有办法近似一下 但不管怎么说 那个矩阵乘法对e1单位向量作用n次就是解析解了 这个矩阵是可以写出来的 但是我懒得写了

其实解析解没那么好表示的 尤其是排列组合 可能生出非常复杂的东西 我之前尝试算某个概率会递增的抽卡手游的期望就是用这种方法 Jordan标准型是没有的 只能算算近似值了

但这种近似是直接再算期望 比你模拟个一百次一万次好得多 因为它相当是同时再算所有情况的期望


*****

####  CCauchy  
##### 57#       发表于 2024-10-17 14:47

<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=66468262&amp;ptid=2203318" target="_blank">xmmc1800 发表于 2024-10-16 22:26</a>

好思路！相当于不考虑每个状态的概率，直接从整体期望的角度做递推，然后再把递推方程改写成微分方程

对 ...</blockquote>
你之前那个递推公式用RSolve解不出吗?


*****

####  btnooni  
##### 58#       发表于 2024-10-17 15:26

第一问n个球涂色n次是个很苛刻的条件概率吧，搭配红球半色球和最多涂两次的规则：

设红球个数为x，涂两次消耗2x次数，则半色球个数=涂一次的次数=涂n次-涂两次的次数=n-2x，而白球个数=n-红球个数x-半色球个数(n-2x)=x
<img src="https://static.saraba1st.com/image/smiley/face2017/091.png" referrerpolicy="no-referrer">不管半色球怎么取，红球和白球的数量居然都是相等的？？？题设条件是怎么搞出这种对称性的？？？？？我很好奇

同时这么一看题设条件的场景已经不是每种排列都能满足的了，当n取5的时候红色球=白色球的取值实际只有0,1,2三大类情况。

计算条件概率得把满足条件的所有场景算出来。情况可分为最基础的摸n次涂n次和摸n+m次涂n次中多的m次两种。第一种是没有摸出过红球的情况，并且具备了所有可能的球排列。第二种不会改变其基础排列，而多出的m次都是在反复摸红球。

设n为偶数时是2a，奇数时为2a+1，则红球白球最大能取到a，下面以偶数为例。

根据前面的题设推导，设红球=白球=x个，半色球为n-2x。

单个基础排列组合可能个数为从2a球中挑2a-2x个白球乘以从剩余2x球中挑x个红球f(x)=C(2a,2a-2x)*C(2x,x)。基础排列每单个组合发生概率相同，第二种排列则在此概率上稀释，最后一步除法其实上下约去了一个总体的概率，不想搞太复杂直接不写了。

当m=1时，可视为从基础排列的概率上再乘以从2a球中选中红球的概率x/2a。m=2则是在m=1的概率之上再乘上x/2a。。。。。。

则每个基础排列和及其衍生的概率之和为f(x)*(1+x/2a+(x/2a)^2.........)，后面是等比数列求和，由于m趋向于无穷求和公示可化简为f(x)*1/(1-x/2a)=f(x)*2a/(2a-x)

所有符合题设的可能排列为①求和x从0取到a的所有f(x)*2a/(2a-x)之和。

在这些排列中半色球占的等效排列数为②求和x从0取到a的所有f(x)*2a/(2a-x)*半色球比总球数(2a-2x)/2a=f(x)*(2a-2x)/(2a-x)之和。

最后半色球的比例期望为②/①。
<img src="https://p.sda1.dev/19/3c77d5f831cf758d005e2f80937a08c3/1729147803543.jpg" referrerpolicy="no-referrer">

用wolfram alpha算了下n=30的情况，得到的期望是0.3333....，趋近于1/3。

几十年没碰过概率+渣文案shi一样的可读性，有错轻喷<img src="https://static.saraba1st.com/image/smiley/face2017/050.png" referrerpolicy="no-referrer">


*****

####  NaCN  
##### 59#         楼主| 发表于 2024-10-18 01:53

<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=66472407&amp;ptid=2203318" target="_blank">fuochai 发表于 2024-10-17 12:56</a>

想到了 直接用一个矩阵表示所有的状态对应的期望 第一位是白球数（即空盒子） 第二位是半红半白 （即1个球 ...</blockquote>
感谢您的回答

关于题目描述，我在44楼讲了背景，您的表述和我的表述本质上等价。

解这道题试图分析每种状态会带来巨大的计算量，我自己就卡在了计算上。我数学能力一般，您提出的矩阵分析和Jordan标准型我都没学过。个人认为48楼和50楼的思路从整体比例期望着手，对数学运算的要求较低，最后也得出了比较满意的结果。


*****

####  NaCN  
##### 60#         楼主| 发表于 2024-10-18 02:00

<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=66473393&amp;ptid=2203318" target="_blank">btnooni 发表于 2024-10-17 15:26</a>

第一问n个球涂色n次是个很苛刻的条件概率吧，搭配红球半色球和最多涂两次的规则：

设红球个数为x，涂两次消 ...</blockquote>
感谢回答

过程我还没时间细看，但结果应该有问题，45楼和50楼给出了几个不同n值的精确解，都大于1/3。


*****

####  ksws0355460  
##### 61#       发表于 2024-10-18 08:17

如果是实验问题，我还是建议实验方法解决，多做几个不同比例的小剂量反应，打核磁/hplc直接看结果比较方便


*****

####  liurun  
##### 62#       发表于 2024-10-18 12:09

这不是很简单吗，考虑单个球不就是二项分布吗

<img src="https://img.saraba1st.com/forum/202410/18/120856eckk3p8lp4pnkpj8.jpg" referrerpolicy="no-referrer">

<strong>402a0267-c62f-4d03-ba55-c7050b82f298.jpg</strong> (146.03 KB, 下载次数: 0)

下载附件

2024-10-18 12:08 上传

—— 来自 [S1Fun](https://s1fun.koalcat.com)


*****

####  fuochai  
##### 63#       发表于 2024-10-18 21:02

<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=66477965&amp;ptid=2203318" target="_blank">NaCN 发表于 2024-10-18 01:53</a>

感谢您的回答

关于题目描述，我在44楼讲了背景，您的表述和我的表述本质上等价。</blockquote>
楼主发文章会ref这个帖子吗<img src="https://static.saraba1st.com/image/smiley/face2017/067.png" referrerpolicy="no-referrer">


*****

####  btnooni  
##### 64#       发表于 2024-10-18 21:45

 本帖最后由 btnooni 于 2024-10-18 21:50 编辑 
<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=66477986&amp;ptid=2203318" target="_blank">NaCN 发表于 2024-10-18 02:00</a>

感谢回答

过程我还没时间细看，但结果应该有问题，45楼和50楼给出了几个不同n值的精确解，都大于1/3。 ...</blockquote>
嗯，我这边思路错了.


*****

####  NaCN  
##### 65#         楼主| 发表于 2024-10-18 23:37

<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=66485900&amp;ptid=2203318" target="_blank">fuochai 发表于 2024-10-18 21:02</a>

楼主发文章会ref这个帖子吗</blockquote>
让您见笑。发文章什么是想多了，简化成概率题的模型已经不能对现实起到指导作用。更复杂的连续二级反应动力学早在1987年就已发表于 Can. J. Chem. <strong>1987</strong>, 65 (8), 1987–1994，讨论了白球可以涂色m次时，涂色k次球的比例随时间的变化。不过需要知道许多参数，最后求得的也是数值解。

之所以我要求解析解，是因为我在程序模拟的时候发现了第一问的答案逼近1/e，但我的数学能力不足以推导出这个结果，而第二问也不是我猜测的1:1时能取得最大值。翻遍互联网问过AI都未果的问题拿来论坛分享两天就有坛友给出解答，第二问还给出了漂亮的2-3/e这个解，让我感受到了数学的美妙。

回到您的问题，假设能够发表，我会列出此贴网址，邀请48楼兔耳僵尸和50楼xmmc1800为共同作者。（现实里谁在乎你的概率题啊，产率低多投料多分离去！<img src="https://static.saraba1st.com/image/smiley/face2017/139.png">


*****

####  love4aids  
##### 66#       发表于 2024-10-19 11:35

我们可以将问题建模为一个马尔可夫过程，并利用泊松分布来分析。以下是详细的解析：

状态定义

袋中的球有三种状态：

        •        W（白球）：未被涂色的白球。
        •        H（半红半白球）：被涂成半红半白的球。
        •        R（红球）：被完全涂成红色的球。

转移规则

        1.        摸出W：变为H，概率为当前W的比例 ￼。
        2.        摸出H：变为R，概率为当前H的比例 ￼。
        3.        摸出R：保持不变，概率为当前R的比例 ￼。

总体模型

假设袋中有无限多个球，比例关系为 ￼。由于每次摸球的操作对一个球的影响可以忽略不计，我们可以将其视为一个连续的过程，并使用微分方程来描述比例的变化。

设 ￼（其中 ￼ 是涂色次数，￼ 很大），则比例随时间 ￼ 的变化可以描述为：
\[
\begin{cases}
\frac{dx}{dt} = -x(t) \\
\frac{dy}{dt} = x(t) - y(t) \\
\frac{dz}{dt} = y(t)
\end{cases}
\]
初始条件为 ￼，￼，￼。

解微分方程

        1.        解 ￼：
￼
        2.        解 ￼：
￼
        3.        解 ￼：
￼

具体问题解析

问题1：当涂色n次，袋中半红半白球的比例期望是多少？

涂色 ￼ 次对应于 ￼（因为 ￼）。因此：
￼
期望比例为 ￼（约36.79%）。

问题2：当袋中半红半白球的比例期望最高时，应当涂色几次？此时半红半白球的比例期望是多少？

函数 ￼ 在 ￼ 处达到最大值。这意味着要使 ￼ 最大，应当涂色 ￼ 次。
此时的最大比例为：
￼
最大比例期望为 ￼（约36.79%），且在涂色 ￼ 次时达到。

结论

        1.        问题1的解析解是 ￼。
        2.        问题2的解析解是：在涂色 ￼ 次时，半红半白球的比例期望达到最大值 ￼。

参考数值：
￼

最终答案：

问题 1 的解析解：在涂色 n 次后，袋中半红半白球的比例期望为 e⁻¹。

问题 2 的解析解：当涂色次数为 n 时，半红半白球的比例期望达到最大值 e⁻¹。

gpt4o1算的，看都看不懂来自: iPhone客户端

